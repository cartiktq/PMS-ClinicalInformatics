# PMS-ClinicalInformatics

The initial version of the code was generated by OpenAI API. The command to the API is as follows:

"""Generate a Python langgraph based agent AI workflow, with the following nodes. 

1) The first node will generate clinical notes containing Protected Health Information (PHI) elements, diagnoses, clinical and behavioral symptoms, lab test results, diagnostic and therapeutic procedures, comorbodities, and prescriptions, for a cohort of 100 patients with Phelan McDermid Syndrome (PMS). For each patient, generate 8 to 10 clinical notes corresponding to multiple patient visits over time where the date of the visit is recorded. The most commonly reported clinical symptoms for PMS are:  "Developmental Delay", "Speech and Language Impairment", "Hypotonia", "Seizures", "Gastrointestinal Issues", "Sleep Disturbances", "Dysmorphia", "Lymphedema", "Renal Abnormalities", "Thermoregulation Issues", "Abnormalities of Nails" and behavioral symptoms are: "Autism Spectrum Disorder (ASD) Features", "Intellectual Disability", "Anxiety", "Aggression/Self-Injurious Behaviors", "Hyperactivity/Impulsivity", "Sensory Processing Differences", "Compulsive Behaviors", "Mood Dysregulation". The most common prescriptions are: "Levetiracetam", "Valproic Acid", "Lamotrigine", "Fluoxetine", "Sertraline", "Risperidone", "Aripiprazole", "Melatonin", "Polyethylene glycol", "Omeprazole", "Ranitidine", "Methylphenidate".  The most common lab tests used are: "Chromosomal Microarray Analysis (CMA)", "FISH", "Karyotype", "EEG", "Metabolic Screens", "Renal Ultrasound", "GI Motility Studies". The most common therapies are: "Early Intervention Programs", "Speech and Language Therapy (SLT)", "Occupational Therapy (OT)", "Physical Therapy (PT)", "Applied Behavior Analysis (ABA) Therapy", "Feeding Therapy", "Behavioral Therapy/Parent Training", "Surgical Interventions". The most common comorbidities are: "Autism Spectrum Disorder (ASD)", "Epilepsy/Seizure Disorder", "Gastrointestinal Disorders", "Sleep Disorders", "Anxiety Disorders", "ADHD", "Obesity", "Lymphedema", "Renal Anomalies", "Immunodeficiency". Use combinations of these items to generate the clinical notes of every patient. Output each clinical note in a raw text file with a name which starts with 'clinical_note_<number>_for_patient_<number>' and has the time stamp in the 'yyyy-mm-dd' format suffixed to it. Output all the generated raw text files to a specific folder called 'raw_clinical_notes'
   
2) The second node reads the clinical notes in raw text format from the folder which the previous agent wrote in to. It uses a Python API to erase all the PHI elements in the each file containing clinical notes and outputs the anonymized clinical notes in raw text format to new text files in to a new folder called 'anonymized_clinical_notes'. The name of each output file will start with 'anonymized' followed by the name of the original file that was input to the agent.

3) The third node compares the raw clinical notes files from the 'raw_clinical_notes' folder with the files with the anonymized clinical notes in the 'anonymized_clinical_notes' folder and performs a file to file comparison. It outputs a metric for the effectiveness of the anonymization process done by the previous node. This node identifies the PHI elements still remaining in all of the anonymized clinical notes. If there are 'C' PHI elements across all the raw text files containing clinical notes in the 'raw_clinical_notes' folder and there are still 'N' PHI elements that are found to be in all of the raw text files containing anonymized clinical notes in the 'anonymized_clinical_notes' folder, the metric will be calculated as (1 - (N/C))*100. Effectively, this will reflect what percent of the PHI elements were removed by the anonymizing node, the previous node. This node outputs this metric to the terminal

4) The fourth node takes a sequence of anonymized clinical notes from the 'anonymized_clinical_notes' folder as input and performs Named Entity Recognition of the diagnoses, lab test results, physical and behavioral symptoms, comorbidities, diagnostic and therapeutic procedures, and prescriptions in the text and outputs a CSV file with three columns: first column with a generated patient ID, second column being one of the following verbs - lab, diagnosis, comorbidity, procedure, therapy, symptom, behavior, prescription, and the third column has the identified entity. For lab test results, the node outputs a second row with userID, lab test name (which was the  named entity in the third column from the previous row), and the result of the lab test

5) The fifth node takes the CSV output by the fourth node and using an API key from UMLS, maps the named entities identified by NER to concepts defined in UMLS Metathesaurus. It outputs a CSV format with six columns: first three columns being the same as the input CSV and the fourth, fifth  and sixth columns containing the CUI, the label of the UMLS Concept, and the description of the concept in UMLS repsectively

6) The sixth node takes the CSV output by the fifth node and using the UMLS API key, finds the AUI from one of the following terminologies for the given CUI: RxNORM, SNOMED CT, ICD-9/10, CPT, OMIM, and HPO. It outputs a CSV file containing these columns: CUI, name of the terminology, the AUI, the label of the AUI in the local terminology, and the description of the AUI. 

7) The seventh node generates a knowledge graph for each patient, with the patient ID being the center of the graph. For this, this node takes as input, the CSV files generated  by the fifth and sixth nodes. In the graph, there is a first level of edges radiating outward from the patient ID. These edges are labelled one of the following: lab, diagnosis, comorbidity, procedure, therapy, symptom, behavior, prescription. The target nodes of these edges are labelled with the UMLS CUIs with the label and description of the CUIs as attributes and also the date obtained from the clinical note as a descriptor. For lab test results, there are edges labelled  "result value" originating from the nodes containing the UMLS CUI for the lab test and terminating in a string literal. In addition, for each node containing a UMLS CUI, there are edges labelled "maps_to" originating from them  and ending in nodes which are labelled with the mapped AUI and the label, description, and name of the local terminology as attributes 

8) the last node generates a visualization of the knowledge graph generated by the previous agent and displays the visualization
"""
